# STM32F4 VSCode Workspace Setup (CubeMX + Make + Clang-Tidy + ST-Link)

This repository documents how to turn your **STM32CubeMX-generated project** into a professional development environment using **VSCode**, **Makefiles**, **Clang-Tidy**, and **ST-Link-based debugging**.
all you need to do is to copy these files to you projetc structure then do some modififcations 
```bash
.clang-format
.clang-format-ingnore 
.clang-tidy
my.mk 
.vscode\ 
```
---

## Project Structure (Generated by CubeMX)

After generating code with CubeMX, you’ll get:
```
.
├── Core/
│ ├── Inc/
│ └── Src/
├── Drivers/
│ ├── CMSIS/
│ └── STM32F4xx_HAL_Driver/
│ └── ...
├── build/ # Where output will be placed
├── Makefile # CubeMx generated makefile 
├── my.mk # My makefile to ( Flash,tidy ...)
├── STM32F407XX_FLASH.ld # Linker script
├── startup_stm32f407xx.s
└── testWork.ioc # CubeMX config
```
---

## 🔧 Toolchain Requirements

Install the following packages:

```bash
sudo apt install gcc-arm-none-eabi make stlink clang-tidy gdb-multiarch
```
Optional (for better linting support):
```bash
code --install-extension ms-vscode.cpptools
code --install-extension marus25.cortex-debug
code --install-extension llvm-vs-code-extensions.vscode-clangd
```
###  Features of This Setup
✅ IntelliSense & navigation (C/C++)

✅ One-click make build

✅ clang-tidy analysis

✅ Flash to MCU with ST-Link (st-flash)

✅ Debug with st-util + GDB via cortex-debug

✅ Project reuse: .vscode folder can be reused for every new CubeMX project

## VSCode Configuration
Create the `.vscode/` folder and add the following files:
- c_cpp_properties.json
```jsonc
{
  "configurations": [
    {
      "name": "STM32",
      "includePath": [
        "${workspaceFolder}/Core/Inc",
        "${workspaceFolder}/Drivers/STM32F4xx_HAL_Driver/Inc",
        "${workspaceFolder}/Drivers/CMSIS/Device/ST/STM32F4xx/Include",
        "${workspaceFolder}/Drivers/CMSIS/Include"
      ],
      "defines": [
        "STM32F407xx",
        "USE_HAL_DRIVER"
      ],
      "compilerPath": "/usr/bin/arm-none-eabi-gcc",
      "cStandard": "c11",
      "cppStandard": "c++17",
      "intelliSenseMode": "gcc-arm"
    }
  ],
  "version": 4
}
```
- tasks.json
```jsonc
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Build",
      "type": "shell",
      "command": "make",
      "group": "build",
      "problemMatcher": [
        "$gcc"
      ]
    },
    {
      "label": "Flash",
      "type": "shell",
      "command": "st-flash write build/*.bin 0x8000000",
      "dependsOn": "Build",
      "group": "build"
    },
    {
      "label": "Clang-Tidy",
      "type": "shell",
      "command": "clang-tidy-15",
      "args": [
        "${file}",
        "--",
        "-std=c11",
        "-DSTM32F407xx",
        "-DUSE_HAL_DRIVER",
        "-I./Core/Inc",
        "-I./Drivers/CMSIS/Include",
        "-I./Drivers/CMSIS/Device/ST/STM32F4xx/Include",
        "-I./Drivers/STM32F4xx_HAL_Driver/Inc"
      ],
      "problemMatcher": []
    }
  ]
}
```
> Replace your_project.bin with the name of your output binary.

- launch.json (ST-Link Debug with Cortex-Debug)
```jsonc
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug STM32 (ST-Link)",
      "type": "cortex-debug",
      "request": "launch",
      "servertype": "stlink",
      "device": "STM32F407VG",
      "interface": "swd",
      "executable": "${workspaceFolder}/build/your_project.elf",
      "runToEntryPoint": "main",
      "cwd": "${workspaceFolder}",
      "preLaunchTask": "Build",
      "svdFile": "${workspaceFolder}/Drivers/CMSIS/Device/ST/STM32F4xx/STM32F407.svd"
    }
  ]
}
```
⚙️ Basic Makefile Template
> Updte the my.mk the projectName Variable 
- Build project 
```bash 
make -f my.mk build  
```
- Flash 
```bash
make -f my.mk flash
```
- Runing clang-tidy on a specifc file 
```bash 
make -f my.mk tidy FILE=Core/Src/main.c
```
- Runing clang-tidy on all files 
```bash 
make -f my.mk tidy 
```
- Fomatting code 
```bash 
make -f my.mk format 
```
- Clean 
```bash 
make -f my.mk clea
```
## Kebindings 
in vscode -> command palette -> open keybindgs (JSON)
```jsonc
[
  {
    "key": "ctrl+alt+b",
    "command": "workbench.action.tasks.runTask",
    "args": "Build"
  },
  {
    "key": "ctrl+alt+f",
    "command": "workbench.action.tasks.runTask",
    "args": "Flash"
  },
  {
    "key": "ctrl+alt+l",
    "command": "workbench.action.tasks.runTask",
    "args": "Clang-Tidy"
  },
  {
    "key": "ctrl+alt+i",
    "command": "editor.action.formatDocument"
    // "when": "editorLangId == c"
  },
  {
    "key": "ctrl+alt+d",
    "command": "workbench.action.debug.start"
  }
]
```


##  Reuse This Workspace
Copy the `.vscode/` folder into any new STM32 project and adjust only:

- The ELF/BIN filenames

- The MCU-specific names (STM32F407VG)

